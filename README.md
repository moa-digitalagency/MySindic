# MySindic - Gestion Moderne de Copropri√©t√©

![MySindic Banner](frontend/static/images/modern_apartment_bui_04cc653f.jpg)

**Solution compl√®te et digitale pour les syndics et r√©sidents au Maroc**

MySindic est une application web progressive (PWA) moderne con√ßue pour simplifier et digitaliser la gestion des copropri√©t√©s au Maroc. Elle offre une interface intuitive et responsive pour les administrateurs de syndic et les r√©sidents.

## üìã Table des Mati√®res

- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Technologies](#-technologies)
- [Installation](#-installation)
- [Utilisation](#-utilisation)
- [Comptes de D√©monstration](#-comptes-de-d√©monstration)
- [API Documentation](#-api-documentation)
- [S√©curit√©](#-s√©curit√©)
- [D√©ploiement](#-d√©ploiement)

## ‚ú® Fonctionnalit√©s

### üë®‚Äçüíº Pour les Superadmins

#### Gestion des R√©sidences
- ‚úÖ Cr√©ation et configuration de nouvelles r√©sidences avec assistant wizard
- ‚úÖ Gestion compl√®te des copropri√©t√©s (CRUD)
- ‚úÖ Gestion des lots/unit√©s avec informations propri√©taires
- ‚úÖ Support multi-r√©sidences

#### Gestion Financi√®re
- ‚úÖ **Appels de fonds** : Cr√©ation et publication des charges
- ‚úÖ **R√©partition automatique** : Calcul par tanti√®mes/surface
- ‚úÖ **Suivi des paiements** : Validation et historique
- ‚úÖ **Recouvrement** : Suivi des impay√©s par lot
- ‚úÖ **Solde en temps r√©el** : Consultation du solde de chaque lot

#### Maintenance et Travaux
- ‚úÖ Suivi des demandes de maintenance des r√©sidents
- ‚úÖ Gestion du statut (pending, in_progress, completed)
- ‚úÖ Attribution aux prestataires
- ‚úÖ **Carnet d'entretien** : Historique complet des interventions
- ‚úÖ Documentation des travaux avec factures et garanties

#### Assembl√©es G√©n√©rales
- ‚úÖ Organisation compl√®te des AG (convocation, ordre du jour)
- ‚úÖ Gestion des r√©solutions avec vote √©lectronique
- ‚úÖ Envoi automatique des convocations
- ‚úÖ Suivi des pr√©sences
- ‚úÖ Gestion des votes (pour, contre, abstention)

#### Communication
- ‚úÖ **Actualit√©s** : Publication de news avec √©pinglage
- ‚úÖ **Sondages** : Cr√©ation de questionnaires avec options multiples
- ‚úÖ Notifications automatiques

#### Gestion des Contentieux
- ‚úÖ Suivi des litiges et proc√©dures juridiques
- ‚úÖ Gestion des contentieux par lot

#### Administration
- ‚úÖ Gestion des utilisateurs et r√¥les
- ‚úÖ Dashboard avec statistiques cl√©s
- ‚úÖ Gestion des documents officiels
- ‚úÖ Param√®tres de l'application
- ‚úÖ Code personnalis√© (injection <head>)

### üè† Pour les R√©sidents

#### Dashboard Personnalis√©
- ‚úÖ Vue d'ensemble : maintenance, solde, AG, actualit√©s
- ‚úÖ Indicateurs cl√©s en temps r√©el
- ‚úÖ Notifications importantes

#### Maintenance
- ‚úÖ **Cr√©ation de demandes** : Formulaire simplifi√© par cat√©gorie
- ‚úÖ **Suivi en temps r√©el** : Statut et progression
- ‚úÖ Consultation de l'historique des interventions
- ‚úÖ Acc√®s au carnet d'entretien de la r√©sidence

#### Finances
- ‚úÖ **Consultation des charges** : Historique et d√©tails
- ‚úÖ **Charges impay√©es** : Liste claire des dus
- ‚úÖ **Solde du compte** : Situation financi√®re √† jour
- ‚úÖ **D√©claration de paiement** : Enregistrement facile
- ‚úÖ Historique complet des paiements

#### Information et Communication
- ‚úÖ **Actualit√©s** : Fil d'infos de la r√©sidence
- ‚úÖ **Documents** : Acc√®s aux documents publics
- ‚úÖ **Sondages** : Participation et r√©sultats
- ‚úÖ Notifications personnalis√©es

#### Assembl√©es G√©n√©rales
- ‚úÖ Consultation des AG (pass√©es et √† venir)
- ‚úÖ Confirmation de pr√©sence en ligne
- ‚úÖ Vote sur les r√©solutions
- ‚úÖ Consultation des r√©sultats

### üîê Authentification et S√©curit√©

- ‚úÖ Inscription et connexion s√©curis√©es
- ‚úÖ Hashing des mots de passe (Werkzeug)
- ‚úÖ Gestion des r√¥les (Superadmin, Admin Syndic, Propri√©taire, R√©sident)
- ‚úÖ Protection des routes par authentification
- ‚úÖ Validation stricte residence_id (protection escalade privil√®ges)
- ‚úÖ Sessions s√©curis√©es avec Flask-Login

## üõ† Technologies

### Backend
- **Framework** : Flask 3.0.0
- **ORM** : SQLAlchemy 2.0.23 + Flask-SQLAlchemy 3.1.1
- **Base de donn√©es** : PostgreSQL (Neon)
- **Migrations** : Flask-Migrate 4.0.5
- **Authentification** : Flask-Login 0.6.3
- **S√©curit√©** : Werkzeug 3.0.1, PyJWT 2.8.0, cryptography 41.0.7
- **Serveur** : Gunicorn 21.2.0
- **CORS** : Flask-CORS 4.0.0
- **Email** : Flask-Mail 0.9.1

### Frontend
- **HTML5** : Templates Jinja2
- **CSS** : Tailwind CSS 3.x (CDN)
- **JavaScript** : Vanilla JS moderne (ES6+)
- **Icons** : Feather Icons
- **PWA** : Service Workers, Manifest

### Base de Donn√©es

**18 Mod√®les de Donn√©es** :
1. User - Utilisateurs
2. Residence - Copropri√©t√©s
3. Unit - Lots/appartements
4. MaintenanceRequest - Demandes de maintenance
5. MaintenanceLog - Carnet d'entretien
6. Document - Documents officiels
7. Charge - Appels de fonds
8. ChargeDistribution - R√©partition des charges
9. Payment - Paiements
10. News - Actualit√©s
11. Poll - Sondages
12. PollOption - Options de sondage
13. PollVote - Votes sur sondages
14. GeneralAssembly - Assembl√©es g√©n√©rales
15. Resolution - R√©solutions d'AG
16. Vote - Votes sur r√©solutions
17. Attendance - Pr√©sences aux AG
18. Litigation - Litiges

## üöÄ Installation

### Pr√©requis
- Python 3.11+
- PostgreSQL
- pip

### Installation Locale

```bash
# Cloner le repository
git clone <repo-url>
cd mysindic

# Installer les d√©pendances
pip install -r requirements.txt

# Configurer les variables d'environnement
export DATABASE_URL="postgresql://user:password@localhost/mysindic"
export SESSION_SECRET="votre-secret-key-aleatoire"

# Initialiser la base de donn√©es avec donn√©es de d√©mo
python init_db.py

# Lancer l'application
gunicorn --bind 0.0.0.0:5000 --reload main:app
```

### Sur Replit

L'application est pr√©-configur√©e pour Replit :
1. Les d√©pendances s'installent automatiquement
2. La base de donn√©es PostgreSQL est provisionn√©e
3. Le workflow d√©marre automatiquement sur le port 5000
4. Les donn√©es de d√©mo sont initialis√©es au premier lancement

## üìñ Utilisation

### Acc√®s √† l'Application

**URL locale** : `http://localhost:5000`
**URL Replit** : Fournie par Replit dans l'onglet Webview

### üîë Comptes de D√©monstration

L'application est initialis√©e avec 5 comptes de test :

| R√¥le | Email | Mot de passe | Description |
|------|-------|--------------|-------------|
| **Super Admin** | admin@mysindic.ma | Admin123! | Acc√®s complet √† toutes les fonctionnalit√©s |
| **Admin Syndic** | admin.syndic@mysindic.ma | Admin123! | Administration d'une r√©sidence sp√©cifique |
| **Propri√©taire** | owner@mysindic.ma | Owner123! | Propri√©taire d'un lot (Lot 101) |
| **R√©sident 1** | resident@mysindic.ma | Resident123! | R√©sident (Lot 201) |
| **R√©sident 2** | karim@mysindic.ma | Resident123! | R√©sident (Lot 301) |

### Donn√©es de D√©mo Incluses

- **1 r√©sidence** : "Les Jardins de l'Atlas" √† Casablanca
- **5 unit√©s** : Appartements de 75m¬≤ √† 150m¬≤
- **1 appel de fonds** : Charges Q1 2025 (50,000 MAD)
- **2 paiements valid√©s**
- **2 demandes de maintenance** (fuite d'eau, probl√®me √©lectrique)
- **2 entr√©es carnet d'entretien**
- **2 actualit√©s**

## üìö API Documentation

### Endpoints Authentification (5)

```
POST   /api/auth/register      - Inscription
POST   /api/auth/login         - Connexion
POST   /api/auth/logout        - D√©connexion
GET    /api/auth/me            - Utilisateur actuel
GET    /api/auth/check         - V√©rifier authentification
```

### Endpoints Admin (32)

#### Dashboard
```
GET    /api/admin/dashboard    - Statistiques compl√®tes
```

#### R√©sidences et Unit√©s
```
GET    /api/admin/residences                    - Liste des r√©sidences
POST   /api/admin/residences                    - Cr√©er r√©sidence
PUT    /api/admin/residences/:id                - Modifier r√©sidence
GET    /api/admin/residences/:id/units          - Liste des unit√©s
POST   /api/admin/residences/:id/units          - Cr√©er unit√©
POST   /api/admin/units                         - Cr√©er unit√© (simplifi√©)
```

#### Finances
```
GET    /api/admin/charges                       - Liste des charges
POST   /api/admin/charges                       - Cr√©er charge
POST   /api/admin/charges/:id/publish           - Publier et r√©partir
GET    /api/admin/charges/:id/distributions     - R√©partitions
GET    /api/admin/payments                      - Liste des paiements
POST   /api/admin/payments/:id/validate         - Valider paiement
GET    /api/admin/units/:id/balance             - Solde d'un lot
```

#### Actualit√©s
```
GET    /api/admin/news         - Liste actualit√©s
POST   /api/admin/news         - Cr√©er actualit√©
PUT    /api/admin/news/:id     - Modifier actualit√©
DELETE /api/admin/news/:id     - Supprimer actualit√©
```

#### Maintenance
```
GET    /api/admin/maintenance           - Liste demandes
PUT    /api/admin/maintenance/:id       - Modifier demande
```

#### Carnet d'Entretien
```
GET    /api/admin/maintenance-logs      - Liste interventions
POST   /api/admin/maintenance-logs      - Cr√©er intervention
```

#### Assembl√©es G√©n√©rales
```
GET    /api/admin/assemblies                           - Liste AG
POST   /api/admin/assemblies                           - Cr√©er AG
PUT    /api/admin/assemblies/:id                       - Modifier AG
POST   /api/admin/assemblies/:id/resolutions           - Cr√©er r√©solution
POST   /api/admin/assemblies/:id/send-convocations     - Envoyer convocations
```

#### Documents
```
GET    /api/admin/documents     - Liste documents
POST   /api/admin/documents     - Upload document
DELETE /api/admin/documents/:id - Supprimer document
```

#### Litiges
```
GET    /api/admin/litigations   - Liste litiges
POST   /api/admin/litigations   - Cr√©er litige
PUT    /api/admin/litigations/:id - Modifier litige
```

#### Sondages
```
GET    /api/admin/polls         - Liste sondages
POST   /api/admin/polls         - Cr√©er sondage
POST   /api/admin/polls/:id/close - Fermer sondage
```

#### Utilisateurs
```
GET    /api/admin/users         - Liste utilisateurs
PUT    /api/admin/users/:id     - Modifier utilisateur
```

#### Param√®tres
```
GET    /api/admin/settings/custom-head      - Code <head>
POST   /api/admin/settings/custom-head      - Sauvegarder code
```

### Endpoints R√©sidents (24)

#### Dashboard
```
GET    /api/resident/dashboard  - Vue d'ensemble personnalis√©e
```

#### Actualit√©s
```
GET    /api/resident/news       - Liste actualit√©s
GET    /api/resident/news/:id   - D√©tail actualit√©
```

#### Maintenance
```
POST   /api/resident/maintenance        - Cr√©er demande
GET    /api/resident/maintenance        - Mes demandes
GET    /api/resident/maintenance/:id    - D√©tail demande
GET    /api/resident/maintenance-logs   - Carnet d'entretien
```

#### Finances
```
GET    /api/resident/charges            - Mes charges
GET    /api/resident/charges/unpaid     - Charges impay√©es
GET    /api/resident/balance            - Mon solde
POST   /api/resident/payments           - D√©clarer paiement
GET    /api/resident/payments           - Historique paiements
```

#### Documents
```
GET    /api/resident/documents          - Documents publics
GET    /api/resident/documents/:id      - D√©tail document
```

#### Sondages
```
GET    /api/resident/polls              - Sondages actifs
GET    /api/resident/polls/:id          - D√©tail sondage
POST   /api/resident/polls/:id/vote     - Voter
```

#### Assembl√©es G√©n√©rales
```
GET    /api/resident/assemblies                 - Liste AG
GET    /api/resident/assemblies/:id             - D√©tail AG
POST   /api/resident/assemblies/:id/attend      - Confirmer pr√©sence
POST   /api/resident/resolutions/:id/vote       - Voter r√©solution
```

### Format des R√©ponses

#### Succ√®s
```json
{
  "success": true,
  "data": { ... },
  "message": "Operation r√©ussie"
}
```

#### Erreur
```json
{
  "success": false,
  "error": "Description de l'erreur"
}
```

## üîí S√©curit√©

### Mesures Impl√©ment√©es

1. **Authentification**
   - Hashing s√©curis√© des mots de passe (Werkzeug scrypt)
   - Sessions s√©curis√©es avec Flask-Login
   - Token CSRF automatique

2. **Autorisation**
   - Contr√¥le d'acc√®s bas√© sur les r√¥les (RBAC)
   - D√©corateurs `@login_required` et `@superadmin_required`
   - Validation stricte `residence_id` sur tous les endpoints

3. **Protection des Donn√©es**
   - Aucune exposition de secrets ou cl√©s
   - Filtrage par `residence_id` et `user_id` automatique
   - Protection contre l'escalade de privil√®ges

4. **Validation**
   - Validation des entr√©es utilisateur
   - Protection contre les injections SQL (ORM)
   - Sanitization des donn√©es

5. **HTTPS**
   - Proxy Fix configur√© pour HTTPS
   - Headers de s√©curit√© appropri√©s

## üöÄ D√©ploiement

### D√©ploiement sur Replit

L'application est configur√©e pour le d√©ploiement automatique sur Replit :

```yaml
deployment_target: autoscale
run: ["gunicorn", "--bind", "0.0.0.0:5000", "main:app"]
```

Cliquez sur le bouton "Deploy" dans Replit pour publier.

### Variables d'Environnement Requises

```bash
DATABASE_URL=postgresql://...       # Fourni automatiquement par Replit
SESSION_SECRET=...                  # G√©n√©r√© automatiquement
PGHOST=...                         # Fourni par Replit
PGPORT=...                         # Fourni par Replit
PGUSER=...                         # Fourni par Replit
PGPASSWORD=...                     # Fourni par Replit
PGDATABASE=...                     # Fourni par Replit
```

### D√©ploiement sur VPS

Un script de d√©ploiement est fourni :

```bash
chmod +x deploy_vps.sh
./deploy_vps.sh
```

Le script :
- Configure un environnement virtuel
- Installe les d√©pendances
- Configure Nginx
- Installe systemd pour Gunicorn
- Configure SSL avec Certbot

## üìù Structure du Projet

```
mysindic/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ models/           # 18 mod√®les SQLAlchemy
‚îÇ   ‚îú‚îÄ‚îÄ routes/           # Blueprints API (auth, admin, resident)
‚îÇ   ‚îú‚îÄ‚îÄ utils/            # Utilitaires (calculs, notifications)
‚îÇ   ‚îú‚îÄ‚îÄ app.py            # Application Flask principale
‚îÇ   ‚îú‚îÄ‚îÄ config.py         # Configuration
‚îÇ   ‚îî‚îÄ‚îÄ init_demo_data.py # Initialisation donn√©es d√©mo
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/          # Styles Tailwind
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/           # JavaScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ images/       # Assets
‚îÇ   ‚îî‚îÄ‚îÄ templates/        # Templates Jinja2
‚îÇ       ‚îú‚îÄ‚îÄ admin/        # Pages admin
‚îÇ       ‚îú‚îÄ‚îÄ resident/     # Pages r√©sident
‚îÇ       ‚îî‚îÄ‚îÄ auth/         # Pages authentification
‚îú‚îÄ‚îÄ main.py               # Point d'entr√©e
‚îú‚îÄ‚îÄ requirements.txt      # D√©pendances Python
‚îî‚îÄ‚îÄ README.md            # Cette documentation
```

## ü§ù Support

Pour toute question ou probl√®me :
- **Email** : moa@myoneart.com
- **Site** : www.myoneart.com

## üìÑ Licence

¬© 2025 MySindic - Shabaka Syndic par Aisance KALONJI

---

**MySindic** - Gestion Moderne de Copropri√©t√© pour le Maroc üá≤üá¶
